lib
      # stack management
        opcode push:Int
        opcode push:Float
        opcode push:String
       #opcode push:Opcode
        opcode pop
        opcode popN
        opcode pop:Int          # pop n values
        opcode dup:Int          # duplicate n-th value on top of stack

      # objects
        opcode clone

      # tests

        opcode inf
        opcode sup
        opcode eq
        opcode nEq
        opcode infEq
        opcode supEq

        opcode SZ               # skip next instruction if zero
        opcode SNZ              # skip next instruction if non zero
      # raw exception handling
        opcode instCatcher:Label        # try {         # label is catch address
        opcode uninstCatcher:Label      # }             # label is end
                                                        # of catch bloc
        opcode throw                    # try and pop data and jump to
                                        # top catcher or fail
        opcode getException             # push current exception
        
      # jumps
        opcode jmp:Label        # relative intra-segment jump
      # call stack
        opcode call             # call a function object
        opcode call_vc          # pop function object, pop array or
                                # VObj, use the latter as closure and
                                # call the former.
        opcode call:Label       # intra-segment call
        opcode retval:Int       # copy stack top then pop out n values
                                # then poke old stack top then return
        opcode ret:Int          # pop out n values then return

      # function objects
        opcode dynFunNew:Label    # push func obj
        opcode dynFunAddClosure   # pop (data to clone), peek func obj
        opcode getClosure:Int     # pop (data to clone), peek func obj
        opcode getClosure         # pop (data to clone), peek func obj

      # address space management
        opcode enter:Int        # reserve n local variables
        opcode leave:Int        # undo previous enter

        opcode getClosure:Int

        opcode getmem:Int       # n>0  : push n-th global data
                                # n<=0 : push n-th local data
        opcode setmem:Int       # pop data into mem cell #n (see above)
        opcode getmem           # pop n from data stack then getmem n
        opcode setmem           # pop n from data stack then setmem n
      # bin&arith
        opcode shr              # shift right
        opcode shr:Int          # shift right n bits
        opcode vshr             # pop n then shift right n bits

        opcode shl              # shift left
        opcode shl:Int          # shift left n bits
        opcode vshl             # pop n then shift left n bits

        opcode and
        opcode or
        opcode not
        opcode xor
        opcode and:Int
        opcode or:Int
        opcode xor:Int

        opcode inc
        opcode dec

        opcode mod
        opcode mod:Int
        opcode mod:Float

        opcode add              # use two values on top of stack
        opcode sub
        opcode mul
        opcode div

        opcode add:Int          # use top of stack and immed value
        opcode sub:Int
        opcode mul:Int
        opcode div:Int

        opcode add:Float
        opcode sub:Float
        opcode mul:Float
        opcode div:Float

        opcode sin
        opcode cos
        opcode tan

      # AST manipulation
        opcode astGetOp
        opcode astGetRow
        opcode astGetCol
        opcode astGetChildString
        opcode astGetChildString:Int
        opcode astGetChildrenCount
        opcode astCompileChild:Int
        opcode astCompileChild

      # compiler manipulation
        opcode onCompInit               # pop dynFun
        opcode onCompTerm               # pop dynFun
        opcode __addCompileMethod:Label
        opcode write_data               # pop data, pop rep, write
        opcode write_label:String
        opcode write_label
        opcode write_oc:String
        opcode write_ocInt:String
        opcode write_ocFloat:String
        opcode write_ocLabel:String
        opcode write_ocString:String
        opcode write_ocEnvSym:String
        opcode write_oc
        opcode write_ocInt
        opcode write_ocFloat
        opcode write_ocLabel
        opcode write_ocString
        opcode write_ocEnvSym

        opcode compileStateNext
        opcode compileStateDown
        opcode compileStateUp
        opcode compileStateDone
        opcode compileStateError

        opcode pp_curNode

        #opcode _pop_curNode

        opcode _langDef:String
        opcode _langPlug:String         # pop plug

        opcode compileString

        opcode doWalk:String            # walk current node with named
        opcode doWalk                   # walker, or pop name from stack
        opcode walkChild:Int            # perform walking on this child
        opcode walkChild

      # handling symbol tables
        opcode newSymTab                # create a new sym tab and push
                                        # it onto data stack
        opcode symTabSz
        opcode getSym                   #pop key, pop table, push index
        opcode getSymName               #pop key, pop table, push symbol
        opcode addSym                   # pop key, pop table

      # runtime environment
        opcode envLookup                # [symbol] => offset
        opcode envGet                   # [symbol] => env value
        opcode envGet:EnvSym
        opcode envSet:EnvSym
        opcode envAdd

        opcode mapNew
        opcode mapHasKey
        opcode mapGet
        opcode mapSet
        opcode mapHasKey:String
        opcode mapGet:String
        opcode mapSet:String

      # handling arrays
        opcode arrayNew
        opcode arrayResv:Int
        opcode arrayResv
        opcode arrayGet:Int
        opcode arrayGet
        opcode arraySet:Int
        opcode arraySet
        opcode arraySize

      # handling object stacks
        opcode stackNew
        opcode stackPush
        opcode stackPop
        opcode stackPeek
        opcode stackPop:Int
        opcode stackPeek:Int
        opcode stackSize

      # string operations
        opcode strcmp:String
        opcode strcat:String
        opcode strdup:String
        opcode strcmp
        opcode strcat
        opcode strdup
        opcode strlen
        opcode charAt:Int
        opcode setCharAt:Int
        opcode charAt
        opcode setCharAt
        opcode substr

      # basic conversions
        opcode toS
        opcode toI
        opcode toF

      # threading
        opcode newThread:Label          # pop prio
        opcode getPid                   # push int
        opcode yield                    # yield current thread
        opcode joinThread               # pop int thread pid
        opcode killThread               # pop int thread pid

        opcode newMtx
        opcode lockMtx:Int              # ref a memcell
        opcode unlockMtx:Int            # same
        opcode lockMtx                  # pop int memcell
        opcode unlockMtx                # same


      # FIXME: output and debug mechanisms
        opcode print:Int
        opcode print                    # pop n





        end

